---
import BlogLayout from '../../layouts/BlogLayout.astro';
import { fetchBlogBySlug } from '../../utils/api.js';
import Blogs from '../../components/base/Blogs.jsx';
import Reviews from '../../components/base/Reviews.jsx';

const { slug } = Astro.params;

// Fetch blog data by slug
const blogData = await fetchBlogBySlug(slug);

// Check if the blog data is available
const blog = blogData?.data?.[0];

// Client-side check for authentication using localStorage
let isAuthenticated = false;
if (typeof window !== 'undefined') {
  isAuthenticated = !!localStorage.getItem('authToken');
}
---

<BlogLayout>
  {blog ? (
    <>
      <Blogs
        title={blog.attributes.title}
        content={blog.attributes.content}
      />
      {isAuthenticated ? (
        <Reviews />
      ) : (
        <p><a href="/login" class="text-blue-600">Login</a> to leave a comment.</p>
      )}
    </>
  ) : (
    <p>Blog not found.</p>
  )}
</BlogLayout>
